@startuml
actor Actor
participant ":Quotely" as Quotely
participant ":Storage" as Storage
participant ":JsonSerializer" as Serializer
participant "appData1:ApplicationData" as AppData1
participant "appData2:ApplicationData" as AppData2
participant ":Parser" as Parser
participant "cmd:Command" as Command
database "quotely.json" as DB

skinparam sequenceArrowThickness 2
skinparam roundcorner 5
skinparam padding 2

group App Startup (Loading Data)
    Actor -> Quotely ++ #Gold: Starts Application
    Quotely -> Quotely: new Quotely()

    Quotely -> Quotely ++ #LightBlue: loadDataFromFile()
    Quotely -> Storage ++ #Pink: loadData()
    Storage -> DB: Read File
    Storage --> Quotely: jsonString
    deactivate Storage

    Quotely -> Serializer ++ #technology: deserialize(jsonString)
    Serializer -> AppData1 **: new ApplicationData(jsonString)
    activate AppData1 #LavenderBlush
    return appData:ApplicationData
    return appData:ApplicationData

    Quotely -> AppData1 ++ #LavenderBlush : getQuoteList()
    return quoteList

    Quotely -> AppData1 ++ #LavenderBlush: getCompanyName()
    return companyName

    return
    destroy AppData1
    return
end

group Command Execution (Saving Data)
    Actor -> Quotely ++ #Gold: register c/New Company

    ' 1. Parse Command
    Quotely -> Parser ++ #DarkSalmon: parse(...)
    Parser -> Command **: new RegisterCommand(...)
    activate Command #Green
    return cmd:RegisterCommand
    return cmd:RegisterCommand

    ' 2. Execute Command
    Quotely -> Command ++ #Green: execute(..., companyName, ...)
    ' (Command modifies the companyName object in memory)
    return

    ' 3. Save Data
    Quotely -> Quotely ++ #LightBlue: saveDataToFile()

    Quotely -> AppData2 **: new ApplicationData(quoteList, companyName)
    activate AppData2 #LavenderBlush
    return appData

    Quotely -> Serializer ++ #technology: serialize(appData)
    return jsonString

    Quotely -> Storage ++ #Pink: saveData(jsonString)
    Storage -> DB: Write File
    return
    return
    destroy AppData2
    return
end
@enduml